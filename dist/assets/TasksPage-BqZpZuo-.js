import{r as A,E as ce,o as le,t as V,a as c,b as t,w as a,u as e,m as R,n as ne,i as d,A as p,F as se,B as M,g,l as re,q as I,s as me,v as H,x as j,y as C,h as y,a7 as fe,z as pe,a1 as ge,H as X,J as B,a0 as ye,S as h,T as J,c as D,C as ve,p as ie,D as Y,K as Z,X as De,Y as q,L as we,M as Te,a8 as ke,a9 as G,aa as z,ab as Ie,a5 as _e,U as Q,ac as ee,_ as Ce,ad as Ve,ae as be,j as Se,Z as te,$ as xe}from"./index-BR7W-eoC.js";import{f as Ae,r as ae,y as Ne,z as Oe,c as Be,A as He,w as Me,m as $e,t as Ue,a as Fe,B as Ye}from"./index-nbtYRshG.js";import{_ as ue,t as K,u as he}from"./_plugin-vue_export-helper-Cp86hJrl.js";const Le={key:0,class:"error-message"},Pe={key:1},Ee={__name:"TaskModal",props:{task:{type:Object,default:null}},emits:["dismiss","taskSaved"],setup(W,{emit:w}){var $,S,x,U,F;const i=W,N=w,_=A(!!i.task),T=A(!1),v=A(""),O=A([]),m=ce({title:(($=i.task)==null?void 0:$.title)||"",description:((S=i.task)==null?void 0:S.description)||"",priority:((x=i.task)==null?void 0:x.priority)||"medium",dueDate:((U=i.task)==null?void 0:U.dueDate)||new Date(new Date().getTime()+864e5).toISOString(),assignedTo:((F=i.task)==null?void 0:F.assignedTo)||null});le(async()=>{try{O.value=[{id:1,firstName:"Иван",lastName:"Иванов"},{id:2,firstName:"Петр",lastName:"Петров"},{id:3,firstName:"Анна",lastName:"Сидорова"}]}catch(f){console.error("Ошибка загрузки пользователей:",f)}});const L=f=>{var s;N("taskSaved",f);try{(s=document.querySelector("ion-modal:last-of-type"))==null||s.dismiss(f)}catch(r){console.error("Ошибка при закрытии модального окна с данными:",r)}},P=async()=>{var f,s;if(!m.title){v.value="Название задачи обязательно для заполнения";return}T.value=!0,v.value="";try{const r=localStorage.getItem("token");if(!r){v.value="Токен авторизации отсутствует. Выполните вход в систему.",b(v.value,"danger");return}console.log("Токен авторизации:",r);let k;_.value?(k=await K.updateTask(i.task.id,m),b("Задача успешно обновлена","success")):(k=await K.createTask(m),b("Задача успешно создана","success")),L(k.data)}catch(r){v.value=((s=(f=r.response)==null?void 0:f.data)==null?void 0:s.message)||"Ошибка при сохранении задачи",b(v.value,"danger")}finally{T.value=!1}},b=async(f,s="primary")=>{await(await Y.create({message:f,duration:3e3,position:"bottom",color:s})).present()},E=()=>{var f;N("dismiss");try{(f=document.querySelector("ion-modal:last-of-type"))==null||f.dismiss()}catch(s){console.error("Ошибка при закрытии модального окна:",s)}};return(f,s)=>(c(),V(h,null,[t(e(re),null,{default:a(()=>[t(e(R),null,{default:a(()=>[t(e(ne),null,{default:a(()=>[d(p(_.value?"Редактирование задачи":"Новая задача"),1)]),_:1}),t(e(se),{slot:"end"},{default:a(()=>[t(e(M),{onClick:E},{default:a(()=>[t(e(g),{slot:"icon-only",icon:e(Ae)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),t(e(ie),{class:"ion-padding"},{default:a(()=>[I("form",{onSubmit:me(P,["prevent"])},[t(e(j),null,{default:a(()=>[t(e(C),null,{default:a(()=>[t(e(y),{position:"floating"},{default:a(()=>[s[6]||(s[6]=d("Название ")),t(e(fe),{color:"danger"},{default:a(()=>s[5]||(s[5]=[d("*")])),_:1})]),_:1}),t(e(pe),{modelValue:m.title,"onUpdate:modelValue":s[0]||(s[0]=r=>m.title=r),required:""},null,8,["modelValue"])]),_:1}),t(e(C),null,{default:a(()=>[t(e(y),{position:"floating"},{default:a(()=>s[7]||(s[7]=[d("Описание")])),_:1}),t(e(ge),{modelValue:m.description,"onUpdate:modelValue":s[1]||(s[1]=r=>m.description=r),rows:"4"},null,8,["modelValue"])]),_:1}),t(e(C),null,{default:a(()=>[t(e(y),null,{default:a(()=>s[8]||(s[8]=[d("Приоритет")])),_:1}),t(e(X),{modelValue:m.priority,"onUpdate:modelValue":s[2]||(s[2]=r=>m.priority=r),interface:"action-sheet"},{default:a(()=>[t(e(B),{value:"low"},{default:a(()=>s[9]||(s[9]=[d("Низкий")])),_:1}),t(e(B),{value:"medium"},{default:a(()=>s[10]||(s[10]=[d("Средний")])),_:1}),t(e(B),{value:"high"},{default:a(()=>s[11]||(s[11]=[d("Высокий")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e(C),null,{default:a(()=>[t(e(y),null,{default:a(()=>s[12]||(s[12]=[d("Срок выполнения")])),_:1}),t(e(ye),{modelValue:m.dueDate,"onUpdate:modelValue":s[3]||(s[3]=r=>m.dueDate=r),"display-format":"DD.MM.YYYY HH:mm","picker-format":"DD MMM YYYY HH:mm"},null,8,["modelValue"])]),_:1}),t(e(C),null,{default:a(()=>[t(e(y),null,{default:a(()=>s[13]||(s[13]=[d("Исполнитель")])),_:1}),t(e(X),{modelValue:m.assignedTo,"onUpdate:modelValue":s[4]||(s[4]=r=>m.assignedTo=r),interface:"action-sheet"},{default:a(()=>[t(e(B),{value:null},{default:a(()=>s[14]||(s[14]=[d("Не назначено")])),_:1}),(c(!0),V(h,null,J(O.value,r=>(c(),D(e(B),{key:r.id,value:r.id},{default:a(()=>[d(p(r.firstName)+" "+p(r.lastName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),v.value?(c(),V("div",Le,p(v.value),1)):H("",!0),t(e(M),{expand:"block",type:"submit",disabled:T.value},{default:a(()=>[T.value?(c(),D(e(ve),{key:0,name:"crescent"})):(c(),V("span",Pe,p(_.value?"Сохранить изменения":"Создать задачу"),1))]),_:1},8,["disabled"])],32)]),_:1})],64))}},oe=ue(Ee,[["__scopeId","data-v-0dfa18ca"]]),qe={class:"task-meta"},ze={key:1,class:"empty-state"},Re={__name:"TasksPage",setup(W){he();const w=A("all"),i=A([{id:1,title:"Подготовить материалы к уроку",description:"Подготовить презентацию и раздаточные материалы для урока математики",priority:"high",status:"active",completed:!1,createdAt:new Date(new Date().getTime()-864e5),dueDate:new Date(new Date().getTime()+864e5),assignedTo:1,assignedToName:"Иванов И.И.",createdBy:2},{id:2,title:"Проверить контрольные работы",description:"Проверить контрольные работы 10А класса по алгебре",priority:"medium",status:"active",completed:!1,createdAt:new Date(new Date().getTime()-1728e5),dueDate:new Date(new Date().getTime()+1728e5),assignedTo:1,assignedToName:"Иванов И.И.",createdBy:2},{id:3,title:"Заполнить электронный журнал",description:"Заполнить оценки в электронном журнале за прошедшую неделю",priority:"low",status:"completed",completed:!0,createdAt:new Date(new Date().getTime()-2592e5),dueDate:new Date(new Date().getTime()-864e5),assignedTo:1,assignedToName:"Иванов И.И.",createdBy:1}]),N=Z(()=>!i.value||!Array.isArray(i.value)?(console.warn("значение tasks не является массивом:",i.value),[]):i.value.filter(l=>l?w.value==="all"?!0:w.value==="active"?!l.completed:w.value==="completed"?l.completed:!0:!1)),_=Z(()=>{if(!i.value||!Array.isArray(i.value))return console.warn("значение tasks не является массивом:",i.value),[];const o=new Date;o.setDate(o.getDate()+1),o.setHours(0,0,0,0);const l=new Date;return l.setDate(l.getDate()+2),l.setHours(0,0,0,0),i.value.filter(n=>{if(!n||!n.dueDate||n.completed)return!1;const u=new Date(n.dueDate);return u>=o&&u<l})}),T=async()=>{const o=await te.create({component:oe,componentProps:{task:null}});o.onDidDismiss().then(({data:l})=>{l&&(S(),k("Задача успешно создана","success"))}),await o.present()},v=async()=>{alert("Фильтры задач")},O=o=>{alert(`Детали задачи: ${o.title}`)},m=async o=>{const l=await te.create({component:oe,componentProps:{task:o}});l.onDidDismiss().then(({data:n})=>{if(n){const u=i.value.findIndex(de=>de.id===n.id);u!==-1&&(i.value[u]=n),k("Задача успешно обновлена","success")}}),await l.present()},L=o=>{o.completed=!0,o.status="completed",Y.create({message:"Задача выполнена!",duration:2e3,position:"bottom",color:"success"}).then(n=>n.present())},P=o=>{o.status=o.completed?"completed":"active"},b=async o=>{await(await xe.create({header:"Подтверждение",message:`Вы уверены, что хотите удалить задачу "${o.title}"?`,buttons:[{text:"Отмена",role:"cancel"},{text:"Удалить",role:"destructive",handler:()=>E(o)}]})).present()},E=o=>{i.value=i.value.filter(n=>n.id!==o.id),Y.create({message:"Задача удалена",duration:2e3,position:"bottom",color:"medium"}).then(n=>n.present())},$=async o=>{try{await S(),o&&o.detail.complete()}catch(l){console.error("Ошибка при обновлении данных:",l),k("Ошибка при получении задач","danger"),o&&o.detail.complete()}},S=async()=>{try{try{const o=await K.getTasks();if(console.log("Ответ сервера:",o),o.data&&Array.isArray(o.data))i.value=o.data;else if(o.data&&typeof o.data=="object"){const l=o.data.items||o.data.tasks||o.data.data||[];i.value=Array.isArray(l)?l:[]}else console.warn("Данные не в ожидаемом формате, используем мок-данные",o.data)}catch(o){console.error("Ошибка API при загрузке задач:",o)}console.log("Задачи загружены:",i.value)}catch(o){console.error("Ошибка при загрузке задач:",o),k("Ошибка при загрузке задач","danger")}},x=o=>o?new Date(o).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}):"",U=o=>({high:"danger",medium:"warning",low:"success"})[o]||"medium",F=o=>({high:"Высокий",medium:"Средний",low:"Низкий"})[o]||"Не указан",f=o=>{if(!o)return"medium";const l=new Date;l.setHours(0,0,0,0);const n=new Date(l);n.setDate(n.getDate()+1);const u=new Date(o);return u<l?"danger":u.getTime()===l.getTime()?"warning":u.getTime()===n.getTime()?"primary":"medium"},s=o=>{if(!o)return"";const l=new Date;l.setHours(0,0,0,0);const n=new Date(l);n.setDate(n.getDate()+1);const u=new Date(o);return u.setHours(0,0,0,0),u<l?"Просрочено":u.getTime()===l.getTime()?"Сегодня":u.getTime()===n.getTime()?"Завтра":x(o)},r=()=>w.value==="active"?"активных":w.value==="completed"?"завершенных":"";le(async()=>{try{await S()}catch(o){console.error("Failed to load tasks data:",o)}});const k=async(o,l="primary")=>{await(await Y.create({message:o,duration:3e3,position:"bottom",color:l})).present()};return(o,l)=>(c(),D(e(Se),null,{default:a(()=>[t(e(re),null,{default:a(()=>[t(e(R),null,{default:a(()=>[t(e(ne),null,{default:a(()=>l[2]||(l[2]=[d("Задачи")])),_:1}),t(e(se),{slot:"end"},{default:a(()=>[t(e(M),{onClick:T},{default:a(()=>[t(e(g),{slot:"icon-only",icon:e(ae)},null,8,["icon"])]),_:1}),t(e(M),{onClick:v},{default:a(()=>[t(e(g),{slot:"icon-only",icon:e(Ne)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),t(e(R),null,{default:a(()=>[t(e(De),{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=n=>w.value=n)},{default:a(()=>[t(e(q),{value:"all"},{default:a(()=>[t(e(y),null,{default:a(()=>l[3]||(l[3]=[d("Все")])),_:1})]),_:1}),t(e(q),{value:"active"},{default:a(()=>[t(e(y),null,{default:a(()=>l[4]||(l[4]=[d("Активные")])),_:1})]),_:1}),t(e(q),{value:"completed"},{default:a(()=>[t(e(y),null,{default:a(()=>l[5]||(l[5]=[d("Завершенные")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(e(ie),{class:"ion-padding"},{default:a(()=>[t(e(we),{slot:"fixed",onIonRefresh:l[1]||(l[1]=n=>$(n))},{default:a(()=>[t(e(Te))]),_:1}),N.value.length>0?(c(),D(e(j),{key:0},{default:a(()=>[(c(!0),V(h,null,J(N.value,n=>(c(),D(e(ke),{key:n.id},{default:a(()=>[t(e(G),{side:"start"},{default:a(()=>[t(e(z),{color:"success",onClick:u=>L(n)},{default:a(()=>[t(e(g),{slot:"icon-only",icon:e(Oe)},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024),t(e(C),{onClick:u=>O(n),detail:!1,class:"task-item"},{default:a(()=>[t(e(Ie),{slot:"start",modelValue:n.completed,"onUpdate:modelValue":u=>n.completed=u,onIonChange:u=>P(n)},null,8,["modelValue","onUpdate:modelValue","onIonChange"]),t(e(y),null,{default:a(()=>[I("h2",{class:_e({"completed-task":n.completed})},p(n.title),3),I("p",null,p(n.description),1),I("div",qe,[t(e(Q),{color:U(n.priority)},{default:a(()=>[d(p(F(n.priority)),1)]),_:2},1032,["color"]),n.dueDate?(c(),D(e(ee),{key:0},{default:a(()=>[t(e(g),{icon:e(Be)},null,8,["icon"]),d(" "+p(x(n.dueDate)),1)]),_:2},1024)):H("",!0),n.assignedTo?(c(),D(e(ee),{key:1},{default:a(()=>[t(e(g),{icon:e(He)},null,8,["icon"]),d(" "+p(n.assignedToName),1)]),_:2},1024)):H("",!0)])]),_:2},1024),t(e(g),{icon:e(Me),slot:"end"},null,8,["icon"])]),_:2},1032,["onClick"]),t(e(G),{side:"end"},{default:a(()=>[t(e(z),{color:"primary",onClick:u=>m(n)},{default:a(()=>[t(e(g),{slot:"icon-only",icon:e($e)},null,8,["icon"])]),_:2},1032,["onClick"]),t(e(z),{color:"danger",onClick:u=>b(n)},{default:a(()=>[t(e(g),{slot:"icon-only",icon:e(Ue)},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(c(),V("div",ze,[t(e(g),{icon:e(Fe),class:"empty-icon"},null,8,["icon"]),l[7]||(l[7]=I("h3",null,"Нет задач",-1)),I("p",null,"У вас нет "+p(r())+" задач",1),t(e(M),{onClick:T},{default:a(()=>l[6]||(l[6]=[d("Создать задачу")])),_:1})])),_.value.length>0?(c(),D(e(Ce),{key:2},{default:a(()=>[t(e(y),null,{default:a(()=>l[8]||(l[8]=[d("Предстоящие задачи")])),_:1})]),_:1})):H("",!0),_.value.length>0?(c(),D(e(j),{key:3},{default:a(()=>[(c(!0),V(h,null,J(_.value,n=>(c(),D(e(C),{key:n.id,onClick:u=>O(n)},{default:a(()=>[t(e(g),{icon:e(Ye),slot:"start",color:"warning"},null,8,["icon"]),t(e(y),null,{default:a(()=>[I("h2",null,p(n.title),1),I("p",null,"Срок: "+p(x(n.dueDate)),1)]),_:2},1024),t(e(Q),{slot:"end",color:f(n.dueDate)},{default:a(()=>[d(p(s(n.dueDate)),1)]),_:2},1032,["color"])]),_:2},1032,["onClick"]))),128))]),_:1})):H("",!0),t(e(Ve),{vertical:"bottom",horizontal:"end",slot:"fixed"},{default:a(()=>[t(e(be),{onClick:T},{default:a(()=>[t(e(g),{icon:e(ae)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}))}},We=ue(Re,[["__scopeId","data-v-32ae70a6"]]);export{We as default};
