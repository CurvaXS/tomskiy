import{r as p,E as A,t as _,a as c,b as l,w as o,u as t,m as J,n as W,i as u,A as m,F as h,B as V,g as x,l as G,q as v,s as K,v as D,x as P,c as T,y as k,h as b,a7 as Q,z as R,a1 as X,H as Y,J as y,C as Z,p as $,S as ee,D as te}from"./index-BR7W-eoC.js";import{f as le,g as oe,d as ae}from"./index-nbtYRshG.js";import{_ as se,d as z}from"./_plugin-vue_export-helper-Cp86hJrl.js";const ne={class:"file-upload-container"},ue={key:0,class:"selected-file-info"},ie={class:"file-size"},de={key:0,class:"error-message"},re={key:1},ce={__name:"DocumentModal",props:{document:{type:Object,default:null}},emits:["dismiss","documentSaved"],setup(O,{emit:q}){var F,B,M;const f=O,w=q,r=p(!!f.document),I=p(!1),d=p(""),C=p(null),i=p(null),n=A({title:((F=f.document)==null?void 0:F.title)||"",description:((B=f.document)==null?void 0:B.description)||"",category:((M=f.document)==null?void 0:M.category)||"other"}),N=()=>{C.value.click()},U=a=>{const e=a.target.files[0];e&&(i.value=e,n.title||(n.title=e.name.split(".")[0]))},E=a=>{if(a===0)return"0 Байт";const e=1024,s=["Байт","КБ","МБ","ГБ"],g=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,g)).toFixed(2))+" "+s[g]},H=a=>{var e;w("documentSaved",a);try{(e=document.querySelector("ion-modal:last-of-type"))==null||e.dismiss(a)}catch(s){console.error("Ошибка при закрытии модального окна с данными:",s)}},L=async()=>{var a,e;if(!n.title){d.value="Название документа обязательно для заполнения";return}if(!r.value&&!i.value){d.value="Необходимо выбрать файл для загрузки";return}I.value=!0,d.value="";try{let s;if(r.value)s=await z.updateDocument(f.document.id,n),S("Документ успешно обновлен","success");else{const g={...n,file:i.value};s=await z.uploadDocument(g),S("Документ успешно загружен","success")}H(s.data)}catch(s){d.value=((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"Ошибка при сохранении документа",S(d.value,"danger")}finally{I.value=!1}},S=async(a,e="primary")=>{await(await te.create({message:a,duration:3e3,position:"bottom",color:e})).present()},j=()=>{var a;w("dismiss");try{(a=document.querySelector("ion-modal:last-of-type"))==null||a.dismiss()}catch(e){console.error("Ошибка при закрытии модального окна:",e)}};return(a,e)=>(c(),_(ee,null,[l(t(G),null,{default:o(()=>[l(t(J),null,{default:o(()=>[l(t(W),null,{default:o(()=>[u(m(r.value?"Редактирование документа":"Загрузка документа"),1)]),_:1}),l(t(h),{slot:"end"},{default:o(()=>[l(t(V),{onClick:j},{default:o(()=>[l(t(x),{slot:"icon-only",icon:t(le)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),l(t($),{class:"ion-padding"},{default:o(()=>[v("form",{onSubmit:K(L,["prevent"])},[l(t(P),null,{default:o(()=>[l(t(k),null,{default:o(()=>[l(t(b),{position:"floating"},{default:o(()=>[e[4]||(e[4]=u("Название ")),l(t(Q),{color:"danger"},{default:o(()=>e[3]||(e[3]=[u("*")])),_:1})]),_:1}),l(t(R),{modelValue:n.title,"onUpdate:modelValue":e[0]||(e[0]=s=>n.title=s),required:""},null,8,["modelValue"])]),_:1}),l(t(k),null,{default:o(()=>[l(t(b),{position:"floating"},{default:o(()=>e[5]||(e[5]=[u("Описание")])),_:1}),l(t(X),{modelValue:n.description,"onUpdate:modelValue":e[1]||(e[1]=s=>n.description=s),rows:"3"},null,8,["modelValue"])]),_:1}),l(t(k),null,{default:o(()=>[l(t(b),null,{default:o(()=>e[6]||(e[6]=[u("Категория")])),_:1}),l(t(Y),{modelValue:n.category,"onUpdate:modelValue":e[2]||(e[2]=s=>n.category=s),interface:"action-sheet"},{default:o(()=>[l(t(y),{value:"orders"},{default:o(()=>e[7]||(e[7]=[u("Приказы")])),_:1}),l(t(y),{value:"reports"},{default:o(()=>e[8]||(e[8]=[u("Отчеты")])),_:1}),l(t(y),{value:"methodical"},{default:o(()=>e[9]||(e[9]=[u("Методические материалы")])),_:1}),l(t(y),{value:"regulations"},{default:o(()=>e[10]||(e[10]=[u("Положения")])),_:1}),l(t(y),{value:"other"},{default:o(()=>e[11]||(e[11]=[u("Прочее")])),_:1})]),_:1},8,["modelValue"])]),_:1}),r.value?D("",!0):(c(),T(t(k),{key:0},{default:o(()=>[v("div",ne,[l(t(V),{expand:"block",color:"medium",onClick:N,class:"file-select-button"},{default:o(()=>[l(t(x),{slot:"start",icon:t(oe)},null,8,["icon"]),u(" "+m(i.value?"Файл выбран":"Выбрать файл"),1)]),_:1}),v("input",{type:"file",ref_key:"fileInput",ref:C,onChange:U,style:{display:"none"}},null,544),i.value?(c(),_("div",ue,[l(t(x),{icon:t(ae)},null,8,["icon"]),v("span",null,m(i.value.name),1),v("div",ie,m(E(i.value.size)),1)])):D("",!0)])]),_:1}))]),_:1}),d.value?(c(),_("div",de,m(d.value),1)):D("",!0),l(t(V),{expand:"block",type:"submit",disabled:I.value||!r.value&&!i.value},{default:o(()=>[I.value?(c(),T(t(Z),{key:0,name:"crescent"})):(c(),_("span",re,m(r.value?"Сохранить изменения":"Загрузить документ"),1))]),_:1},8,["disabled"])],32)]),_:1})],64))}},ve=se(ce,[["__scopeId","data-v-021047e8"]]);export{ve as D};
