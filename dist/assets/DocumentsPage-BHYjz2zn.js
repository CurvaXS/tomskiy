import{r as O,K as F,o as ie,a3 as P,c as g,w as l,u as o,a as u,b as a,l as ue,m as U,n as ce,i,F as de,B as x,g as d,W as fe,p as me,t as $,v as A,L as pe,M as ge,X as ye,Y as w,h as f,x as z,S as R,T as E,y as H,q as y,A as D,U as De,ac as j,s as ve,_ as we,ad as he,ae as xe,j as Ie,Z as S,af as _e,D as I}from"./index-BR7W-eoC.js";import{D as T}from"./DocumentModal-jbFA5h9A.js";import{g as Ce,y as ke,c as Be,C as q,D as be,d as M,B as Oe,r as $e,j as v,E as Ae,F as Se,G as Te,t as Me}from"./index-nbtYRshG.js";import{_ as Ve,u as Le}from"./_plugin-vue_export-helper-Cp86hJrl.js";const Ne={class:"document-meta"},Fe={key:1,class:"empty-state ion-padding"},Pe={__name:"DocumentsPage",setup(Ue){Le();const m=O(""),c=O("all"),r=O([{id:1,title:"Приказ о проведении педагогического совета",description:"Приказ о проведении внеочередного педагогического совета 15.05.2025",type:"docx",category:"orders",createdAt:new Date(new Date().getTime()-864e5),createdBy:1,createdByName:"Петров А.И.",size:256e3,signed:!0,url:"/documents/order-1.docx"},{id:2,title:"Отчет о проведении открытых уроков за апрель 2025",description:"Сводный отчет о проведенных открытых уроках в апреле 2025 года",type:"pdf",category:"reports",createdAt:new Date(new Date().getTime()-1728e5),createdBy:2,createdByName:"Иванова М.С.",size:15e5,signed:!1,url:"/documents/report-april.pdf"},{id:3,title:"Методические указания по проведению лабораторных работ",description:"Методические указания для учителей физики по проведению лабораторных работ",type:"pdf",category:"methodical",createdAt:new Date(new Date().getTime()-6048e5),createdBy:3,createdByName:"Сидоров К.Л.",size:35e5,signed:!0,url:"/documents/lab-guidelines.pdf"},{id:4,title:"Положение о проведении итоговой аттестации",description:"Положение о порядке проведения итоговой аттестации учащихся 9 и 11 классов",type:"pdf",category:"regulations",createdAt:new Date(new Date().getTime()-12096e5),createdBy:1,createdByName:"Петров А.И.",size:42e4,signed:!0,url:"/documents/regulation-exams.pdf"}]),V=F(()=>{let e=r.value;if(c.value!=="all"&&(e=e.filter(t=>t.category===c.value)),m.value){const t=m.value.toLowerCase();e=e.filter(n=>n.title.toLowerCase().includes(t)||n.description.toLowerCase().includes(t))}return e}),_=F(()=>{const e=new Date;return e.setDate(e.getDate()-3),r.value.filter(t=>new Date(t.createdAt)>=e).sort((t,n)=>new Date(n.createdAt)-new Date(t.createdAt)).slice(0,3)}),C=async()=>{const e=await S.create({component:T,componentProps:{document:null}});e.onDidDismiss().then(({data:t})=>{t&&(r.value.unshift(t),h("Документ успешно загружен","success"))}),await e.present()},G=async()=>{alert("Фильтры документов")},L=e=>{alert(`Открытие документа: ${e.title}`)},K=async e=>{await(await _e.create({header:e.title,buttons:[{text:"Скачать",icon:Ae,handler:()=>{W()}},{text:"Поделиться",icon:Se,handler:()=>{X(e)}},{text:e.signed?"Просмотреть подпись":"Подписать",icon:q,handler:()=>{e.signed?Z(e):Y(e)}},{text:"Редактировать",icon:Te,handler:()=>{J(e)}},{text:"Удалить",role:"destructive",icon:Me,handler:()=>{Q(e)}},{text:"Отмена",role:"cancel"}]})).present()},W=e=>{I.create({message:"Документ скачан",duration:2e3,position:"bottom",color:"success"}).then(n=>n.present())},X=e=>{alert(`Отправка ссылки на документ: ${e.title}`)},Y=e=>{e.signed=!0,I.create({message:"Документ подписан",duration:2e3,position:"bottom",color:"success"}).then(n=>n.present())},Z=e=>{const t=S.create({component:T,componentProps:{document:e}});t.onDidDismiss().then(({data:n})=>{if(n){const s=r.value.findIndex(p=>p.id===n.id);s!==-1&&(r.value[s]=n),h("Документ успешно обновлен","success")}}),t.present()},J=async e=>{const t=await S.create({component:T,componentProps:{document:e}});t.onDidDismiss().then(({data:n})=>{if(n){const s=r.value.findIndex(p=>p.id===n.id);s!==-1&&(r.value[s]=n),h("Документ успешно обновлен","success")}}),await t.present()},Q=async e=>{await(await alertController.create({header:"Подтверждение",message:`Вы уверены, что хотите удалить документ "${e.title}"?`,buttons:[{text:"Отмена",role:"cancel"},{text:"Удалить",role:"destructive",handler:()=>ee(e)}]})).present()},ee=e=>{r.value=r.value.filter(n=>n.id!==e.id),I.create({message:"Документ удален",duration:2e3,position:"bottom",color:"medium"}).then(n=>n.present())},te=()=>{},oe=async e=>{try{r.value=[...r.value],e&&e.detail.complete()}catch(t){console.error("Ошибка при обновлении данных:",t),h("Ошибка при получении документов","danger"),e&&e.detail.complete()}},ne=e=>e?new Date(e).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}):"",ae=e=>{if(!e)return"";const t=new Date,n=new Date(e),s=t-n,p=Math.floor(s/(1e3*60*60*24)),B=Math.floor(s/(1e3*60*60)),b=Math.floor(s/(1e3*60));return p>0?`${p} ${k(p,["день","дня","дней"])} назад`:B>0?`${B} ${k(B,["час","часа","часов"])} назад`:b>0?`${b} ${k(b,["минуту","минуты","минут"])} назад`:"только что"},k=(e,t)=>{const n=[2,0,1,1,1,2];return t[e%100>4&&e%100<20?2:n[e%10<5?e%10:5]]},le=e=>({pdf:v,docx:v,xlsx:v,pptx:v,txt:v,image:v,other:M})[e]||M,se=e=>({pdf:"danger",docx:"primary",xlsx:"success",pptx:"warning",txt:"medium",image:"tertiary",other:"medium"})[e]||"medium",N=e=>({orders:"Приказы",reports:"Отчеты",methodical:"Методички",regulations:"Положения",other:"Прочее"})[e]||"Другое",re=()=>m.value?`Не найдено документов по запросу "${m.value}"`:c.value!=="all"?`В категории "${N(c.value)}" пока нет документов`:"В системе пока нет документов";ie(async()=>{});const h=async(e,t="primary")=>{await(await I.create({message:e,duration:3e3,position:"bottom",color:t})).present()};return P(c,async e=>{}),P(m,async e=>{e.length>=3||e.length}),(e,t)=>(u(),g(o(Ie),null,{default:l(()=>[a(o(ue),null,{default:l(()=>[a(o(U),null,{default:l(()=>[a(o(ce),null,{default:l(()=>t[3]||(t[3]=[i("Документы")])),_:1}),a(o(de),{slot:"end"},{default:l(()=>[a(o(x),{onClick:C},{default:l(()=>[a(o(d),{slot:"icon-only",icon:o(Ce)},null,8,["icon"])]),_:1}),a(o(x),{onClick:G},{default:l(()=>[a(o(d),{slot:"icon-only",icon:o(ke)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),a(o(U),null,{default:l(()=>[a(o(fe),{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=n=>m.value=n),placeholder:"Поиск документов",onIonInput:te},null,8,["modelValue"])]),_:1})]),_:1}),a(o(me),null,{default:l(()=>[a(o(pe),{slot:"fixed",onIonRefresh:t[1]||(t[1]=n=>oe(n))},{default:l(()=>[a(o(ge))]),_:1}),a(o(ye),{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=n=>c.value=n),scrollable:""},{default:l(()=>[a(o(w),{value:"all"},{default:l(()=>[a(o(f),null,{default:l(()=>t[4]||(t[4]=[i("Все")])),_:1})]),_:1}),a(o(w),{value:"orders"},{default:l(()=>[a(o(f),null,{default:l(()=>t[5]||(t[5]=[i("Приказы")])),_:1})]),_:1}),a(o(w),{value:"reports"},{default:l(()=>[a(o(f),null,{default:l(()=>t[6]||(t[6]=[i("Отчеты")])),_:1})]),_:1}),a(o(w),{value:"methodical"},{default:l(()=>[a(o(f),null,{default:l(()=>t[7]||(t[7]=[i("Методички")])),_:1})]),_:1}),a(o(w),{value:"regulations"},{default:l(()=>[a(o(f),null,{default:l(()=>t[8]||(t[8]=[i("Положения")])),_:1})]),_:1})]),_:1},8,["modelValue"]),V.value.length>0?(u(),g(o(z),{key:0},{default:l(()=>[(u(!0),$(R,null,E(V.value,n=>(u(),g(o(H),{key:n.id,button:"",onClick:s=>L(n)},{default:l(()=>[a(o(d),{slot:"start",icon:le(n.type),color:se(n.type)},null,8,["icon","color"]),a(o(f),null,{default:l(()=>[y("h2",null,D(n.title),1),y("p",null,D(n.description),1),y("div",Ne,[a(o(De),{color:"medium"},{default:l(()=>[i(D(N(n.category)),1)]),_:2},1024),a(o(j),null,{default:l(()=>[a(o(d),{icon:o(Be)},null,8,["icon"]),i(" "+D(ne(n.createdAt)),1)]),_:2},1024),n.signed?(u(),g(o(j),{key:0},{default:l(()=>[a(o(d),{icon:o(q),color:"success"},null,8,["icon"]),t[9]||(t[9]=i(" Подписан "))]),_:1})):A("",!0)])]),_:2},1024),a(o(x),{slot:"end",fill:"clear",onClick:ve(s=>K(n),["stop"])},{default:l(()=>[a(o(d),{slot:"icon-only",icon:o(be)},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["onClick"]))),128))]),_:1})):(u(),$("div",Fe,[a(o(d),{icon:o(M),class:"empty-icon"},null,8,["icon"]),t[11]||(t[11]=y("h3",null,"Нет документов",-1)),y("p",null,D(re()),1),a(o(x),{onClick:C},{default:l(()=>t[10]||(t[10]=[i("Загрузить документ")])),_:1})])),_.value.length>0&&c.value==="all"?(u(),g(o(we),{key:2},{default:l(()=>[a(o(f),null,{default:l(()=>t[12]||(t[12]=[i("Недавно добавленные")])),_:1})]),_:1})):A("",!0),_.value.length>0&&c.value==="all"?(u(),g(o(z),{key:3},{default:l(()=>[(u(!0),$(R,null,E(_.value,n=>(u(),g(o(H),{key:n.id,button:"",onClick:s=>L(n)},{default:l(()=>[a(o(d),{slot:"start",icon:o(Oe),color:"primary"},null,8,["icon"]),a(o(f),null,{default:l(()=>[y("h2",null,D(n.title),1),y("p",null,"Добавлен "+D(ae(n.createdAt)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):A("",!0),a(o(he),{vertical:"bottom",horizontal:"end",slot:"fixed"},{default:l(()=>[a(o(xe),{onClick:C},{default:l(()=>[a(o(d),{icon:o($e)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}))}},je=Ve(Pe,[["__scopeId","data-v-557eae4a"]]);export{je as default};
